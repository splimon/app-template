# This workflow runs in downstream repositories created from the template.
# It receives a dispatch event from the template repo and creates a PR with updates.
#
# SETUP REQUIRED IN DOWNSTREAM REPOS:
# 1. Create a GitHub PAT with 'repo' scope
# 2. Add it as a repository secret named 'TEMPLATE_SYNC_TOKEN'

name: Receive Template Sync

on:
  repository_dispatch:
    types: [template-sync]
  # Also allow manual sync via schedule or manual trigger
  schedule:
    - cron: "0 4 * * 1" # Weekly on Monday at 4 AM UTC
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.TEMPLATE_SYNC_TOKEN }}
          fetch-depth: 0

      - name: Sync with template
        uses: AndreasAugustin/actions-template-sync@v2
        with:
          github_token: ${{ secrets.TEMPLATE_SYNC_TOKEN }}
          source_repo_path: jkapali/app-template
          upstream_branch: main
          pr_title: "chore: sync with template repository"
          pr_body: |
            This PR syncs changes from the template repository.

            **Template:** jkapali/app-template
            **Triggered by:** ${{ github.event_name }}

            Please review the changes carefully before merging.
          pr_labels: template-sync,automated
